apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-app-deployment
  labels:
    app: flask-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: flask-app
  template:
    metadata:
      labels:
        app: flask-app
    spec:
      containers:
      - name: flask-app
        image: python:3.12-slim
        command: ["/bin/sh", "-c"]
        args:
          - |
            pip install flask && \
            echo "Files in /deploy-data:" && ls /deploy-data && \
            mkdir -p /app/logs && \
            #chmod -R 755 /deploy-data && \
            cp /deploy-data/app.py /app/ && \
            cp /deploy-data/data.json /app/ && \
            echo "Files in /app:" && ls -l /app && \
            cat /app/app.py && \
            #while true; do sleep 100; done;
            cd /app && FLASK_APP=app flask run --host=0.0.0.0 --port=5000;
        ports:
        - containerPort: 5000
        env:
          - name: FLASK_APP
            value: app:app
        volumeMounts:
        - name: flask-app-code
          mountPath: /deploy-data/app.py
          subPath: app.py
        - name: flask-app-code
          mountPath: /deploy-data/data.json
          subPath: data.json
      volumes:
      - name: flask-app-code
        configMap:
          name: flask-app-configmap
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: flask-app-configmap
  labels:
    app: flask-app
  annotations:
    description: Contains Flask app code and data
binaryData:
  app.py: aW1wb3J0IGxvZ2dpbmcKZnJvbSBmbGFzayBpbXBvcnQgRmxhc2ssIHJlcXVlc3QsIGpzb25pZnkKaW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCB1dWlkCmltcG9ydCBiYXNlNjQKaW1wb3J0IGRhdGV0aW1lCgphcHAgPSBGbGFzayhfX25hbWVfXykKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgTE9HR0lORyBDT05GSUdVUkFUSU9OCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgQ29uZmlndXJlIHRoZSBsb2dnaW5nIG1vZHVsZSB0byB3cml0ZSBERUJVRyAoYW5kIGFib3ZlKSBtZXNzYWdlcyB0byBhIGZpbGUuCiMgQWRqdXN0IGZpbGVuYW1lLCBsZXZlbCwgYW5kIGZvcm1hdCBhcyB5b3UgcHJlZmVyLgpsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgZmlsZW5hbWU9Ii9hcHAvbG9ncy9hcHAubG9nIiwgICMgQ2hhbmdlIHBhdGggYXMgbmVlZGVkCiAgICBsZXZlbD1sb2dnaW5nLkRFQlVHLAogICAgZm9ybWF0PSIlKGFzY3RpbWUpcyBbJShsZXZlbG5hbWUpc10gJShtZXNzYWdlKXMiCikKCiMgUGF0aCB0byBvdXIgSlNPTiBkYXRhIGZpbGUKREFUQV9GSUxFID0gJ2RhdGEuanNvbicKCiMgV2UnbGwga2VlcCBvdXIgZGF0YSBpbiBtZW1vcnkgaW4gYSBnbG9iYWwgJ3N0b3JlJy4Kc3RvcmUgPSB7fQoKZGVmIGxvYWRfZGF0YSgpOgogICAgIiIiCiAgICBMb2FkIHRoZSBkYXRhIGZyb20gZGF0YS5qc29uIG9yIHJldHVybiBhbiBlbXB0eSBkaWN0IGlmIHRoZSBmaWxlIGRvZXNuJ3QKICAgIGV4aXN0IG9yIGZhaWxzIHRvIHBhcnNlLgogICAgIiIiCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoREFUQV9GSUxFKToKICAgICAgICBsb2dnaW5nLmRlYnVnKCJEQVRBX0ZJTEUgZG9lcyBub3QgZXhpc3QsIGluaXRpYWxpemluZyBlbXB0eSBzdG9yZS4iKQogICAgICAgIHJldHVybiB7fQoKICAgIHdpdGggb3BlbihEQVRBX0ZJTEUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgbG9nZ2luZy5kZWJ1ZygiTG9hZGVkIGRhdGEgZnJvbSAlcyBzdWNjZXNzZnVsbHkuIiwgREFUQV9GSUxFKQogICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvciBhcyBlOgogICAgICAgICAgICBsb2dnaW5nLmRlYnVnKCJGYWlsZWQgdG8gZGVjb2RlIEpTT04gZnJvbSAlczogJXMiLCBEQVRBX0ZJTEUsIGUpCiAgICAgICAgICAgIHJldHVybiB7fQoKZGVmIHNhdmVfZGF0YShkYXRhKToKICAgICIiIgogICAgU2F2ZSB0aGUgZGF0YSBkaWN0IGJhY2sgaW50byBkYXRhLmpzb24gKG92ZXJ3cml0ZXMgZmlsZSkuCiAgICAiIiIKICAgIHdpdGggb3BlbihEQVRBX0ZJTEUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICBqc29uLmR1bXAoZGF0YSwgZiwgaW5kZW50PTIpCiAgICBsb2dnaW5nLmRlYnVnKCJTYXZlZCB1cGRhdGVkIGRhdGEgdG8gJXMuIiwgREFUQV9GSUxFKQoKIyBMb2FkIGRhdGEgaW50byAnc3RvcmUnIGF0IGltcG9ydC9zdGFydHVwIHRpbWUuCnN0b3JlID0gbG9hZF9kYXRhKCkKCmRlZiBnZXRfcmVxdWVzdF9kYXRhKCk6CiAgICAiIiIKICAgIEhlbHBlciBmdW5jdGlvbjoKICAgIDEuIEF0dGVtcHRzIHRvIHBhcnNlIEpTT04gZnJvbSByZXF1ZXN0IGJvZHkgKHJlcXVlc3QuZ2V0X2pzb24oc2lsZW50PVRydWUpKS4KICAgIDIuIElmIHRoYXQgZmFpbHMgb3IgaXMgTm9uZSwgcmV0dXJucyByZXF1ZXN0LmZvcm0gaW5zdGVhZC4KICAgIFRoaXMgYWxsb3dzIGVuZHBvaW50cyB0byBhY2NlcHQgZWl0aGVyIEpTT04gb3IgZm9ybS1lbmNvZGVkIGRhdGEuCiAgICAiIiIKICAgIGRhdGEgPSByZXF1ZXN0LmdldF9qc29uKHNpbGVudD1UcnVlKQogICAgaWYgZGF0YSBpcyBOb25lOgogICAgICAgIGRhdGEgPSByZXF1ZXN0LmZvcm0KCiAgICBsb2dnaW5nLmRlYnVnKCJnZXRfcmVxdWVzdF9kYXRhKCkgLT4gJXMiLCBkYXRhKQogICAgcmV0dXJuIGRhdGEKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgMCkgQXV0aGVudGljYXRlCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpAYXBwLnJvdXRlKCcvYXV0aCcsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBhdXRoZW50aWNhdGUoKToKICAgIGF1dGggPSByZXF1ZXN0LmF1dGhvcml6YXRpb24KICAgIGlmIG5vdCBhdXRoIG9yIGF1dGgudXNlcm5hbWUgIT0gJ2xpdml1NXRlc3RzQGdtYWlsLmNvbScgb3IgYXV0aC5wYXNzd29yZCAhPSAnUEBzc3cwcmQ5OTkhJzoKICAgICAgICAiIiJSZXR1cm5zIGEgSlNPTiByZXNwb25zZSBmb3IgdW5hdXRob3JpemVkIGFjY2VzcyAoNDAxKS4iIiIKICAgICAgICByZXNwb25zZSA9IGpzb25pZnkoeydlcnJvcic6ICdVbmF1dGhvcml6ZWQnLCAnbWVzc2FnZSc6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJ30pCiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPSA0MDEKICAgICAgICByZXNwb25zZS5oZWFkZXJzWydXV1ctQXV0aGVudGljYXRlJ10gPSAnQmFzaWMgcmVhbG09IkxvZ2luIFJlcXVpcmVkIicKICAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgIAogICAgcmV0dXJuIGpzb25pZnkoeydzdGF0dXMnOiAnb2snfSksIDIwMAoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyAxYSkgR0VUIC9lbnRpdHkKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KQGFwcC5yb3V0ZSgnL2VudGl0eScsIG1ldGhvZHM9WydHRVQnXSkKZGVmIGdldF9lbnRpdGllcygpOgogICAgIiIiCiAgICBHRVQgL2VudGl0eToKICAgIC0gUmV0dXJucyBhbGwgJ3VzZXInIGVsZW1lbnRzIGZyb20gdGhlIGRhdGEgZmlsZS4KICAgIC0gV3JhcHMgdGhlIHJlc3BvbnNlIGluIHsicmVzdWx0IjogPGRhdGE+LCAic3RhdCI6ICJvayJ9LgogICAgIiIiCiAgICBsb2dnaW5nLmRlYnVnKCI9PT0gW0dFVCAvZW50aXR5XSBJbmNvbWluZyByZXF1ZXN0ID09PSIpCiAgICAKICAgICMgRXh0cmFjdCBhbGwgJ3VzZXInIGVsZW1lbnRzCiAgICB1c2VyX2RhdGEgPSBzdG9yZS5nZXQoJ3VzZXInLCBbXSkKICAgIAogICAgIyBXcmFwIHRoZSByZXNwb25zZQogICAgcmVzcG9uc2UgPSB7CiAgICAgICAgInJlc3VsdCI6IHVzZXJfZGF0YSwKICAgICAgICAic3RhdCI6ICJvayIKICAgIH0KICAgIAogICAgbG9nZ2luZy5kZWJ1ZygiW0dFVCAvZW50aXR5XSBSZXR1cm5pbmcgdXNlciBkYXRhOiAlcyIsIHJlc3BvbnNlKQogICAgcmV0dXJuIGpzb25pZnkocmVzcG9uc2UpLCAyMDAKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgMWIpIFBPU1QgL2VudGl0eQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpAYXBwLnJvdXRlKCcvZW50aXR5JywgbWV0aG9kcz1bJ1BPU1QnXSkKZGVmIGVudGl0eSgpOgogICAgIiIiCiAgICBQT1NUIC9lbnRpdHk6CiAgICAxLiBSZWFkcyB0eXBlX25hbWUsIGF0dHJpYnV0ZXMsIGtleV9hdHRyaWJ1dGUsIGtleV92YWx1ZSBmcm9tIHRoZSByZXF1ZXN0IGJvZHkuCiAgICAyLiBTZWFyY2hlcyBmb3IgdGhlIGZpcnN0IG1hdGNoaW5nIGVudGl0eSBpbiBzdG9yZVt0eXBlX25hbWVdLgogICAgMy4gUmV0dXJucyBvbmx5IHRoZSByZXF1ZXN0ZWQgYXR0cmlidXRlcyBpbiB7InJlc3VsdCI6IHsuLi59LCAic3RhdCI6ICJvayJ9LgogICAgIiIiCiAgICBsb2dnaW5nLmRlYnVnKCI9PT0gW1BPU1QgL2VudGl0eV0gSW5jb21pbmcgcmVxdWVzdCA9PT0iKQogICAgZGF0YSA9IGdldF9yZXF1ZXN0X2RhdGEoKQoKICAgIHR5cGVfbmFtZSAgID0gZGF0YS5nZXQoJ3R5cGVfbmFtZScpCiAgICBhdHRyaWJ1dGVzICA9IGRhdGEuZ2V0KCdhdHRyaWJ1dGVzJykKICAgIGtleV9hdHRyICAgID0gZGF0YS5nZXQoJ2tleV9hdHRyaWJ1dGUnKQogICAga2V5X3ZhbHVlICAgPSBkYXRhLmdldCgna2V5X3ZhbHVlJykKCiAgICBsb2dnaW5nLmRlYnVnKCJQYXJzZWQgZmllbGRzIC0+IHR5cGVfbmFtZTogJXMsIGF0dHJpYnV0ZXM6ICVzLCBrZXlfYXR0cjogJXMsIGtleV92YWx1ZTogJXMiLAogICAgICAgICAgICAgICAgICB0eXBlX25hbWUsIGF0dHJpYnV0ZXMsIGtleV9hdHRyLCBrZXlfdmFsdWUpCgogICAgIyBIYW5kbGUgYXR0cmlidXRlcyB3aGljaCBtYXkgYmUgYSBKU09OIHN0cmluZyBvciBhIFB5dGhvbiBsaXN0CiAgICBpZiBpc2luc3RhbmNlKGF0dHJpYnV0ZXMsIHN0cik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhdHRyaWJ1dGVzID0ganNvbi5sb2FkcyhhdHRyaWJ1dGVzKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgYXR0cmlidXRlcyA9IFtdCiAgICBlbGlmIGF0dHJpYnV0ZXMgaXMgTm9uZToKICAgICAgICBhdHRyaWJ1dGVzID0gW10KCiAgICAjIFN0cmlwIHF1b3RlcyBpZiBrZXlfdmFsdWUgaXMgd3JhcHBlZCBpbiBkb3VibGUgcXVvdGVzCiAgICBpZiBpc2luc3RhbmNlKGtleV92YWx1ZSwgc3RyKSBhbmQga2V5X3ZhbHVlLnN0YXJ0c3dpdGgoJyInKSBhbmQga2V5X3ZhbHVlLmVuZHN3aXRoKCciJyk6CiAgICAgICAga2V5X3ZhbHVlID0ga2V5X3ZhbHVlLnN0cmlwKCciJykKCiAgICAjIFZhbGlkYXRlIHRoZSBleGlzdGVuY2Ugb2YgdHlwZV9uYW1lIGluIG91ciBzdG9yZQogICAgaWYgbm90IHR5cGVfbmFtZSBvciB0eXBlX25hbWUgbm90IGluIHN0b3JlOgogICAgICAgIGxvZ2dpbmcuZGVidWcoIltQT1NUIC9lbnRpdHldIHR5cGVfbmFtZSBtaXNzaW5nIG9yIG5vdCBmb3VuZCBpbiBzdG9yZS4iKQogICAgICAgIHJldHVybiBqc29uaWZ5KHsicmVzdWx0Ijoge30sICJzdGF0IjogIm9rIn0pCgogICAgbWF0Y2hlZF9pdGVtID0gTm9uZQogICAgZm9yIGl0ZW0gaW4gc3RvcmVbdHlwZV9uYW1lXToKICAgICAgICBpZiBzdHIoaXRlbS5nZXQoa2V5X2F0dHIsICcnKSkgPT0gc3RyKGtleV92YWx1ZSk6CiAgICAgICAgICAgIG1hdGNoZWRfaXRlbSA9IGl0ZW0KICAgICAgICAgICAgYnJlYWsKCiAgICBpZiBub3QgbWF0Y2hlZF9pdGVtOgogICAgICAgIGxvZ2dpbmcuZGVidWcoIltQT1NUIC9lbnRpdHldIE5vIG1hdGNoaW5nIGl0ZW0gZm91bmQuIikKICAgICAgICByZXR1cm4ganNvbmlmeSh7InJlc3VsdCI6IHt9LCAic3RhdCI6ICJvayJ9KQoKICAgICMgQnVpbGQgYSByZXN1bHQgZGljdCB3aXRoIG9ubHkgdGhlIHJlcXVlc3RlZCBhdHRyaWJ1dGVzCiAgICByZXN1bHQgPSB7fQogICAgZm9yIGF0dHIgaW4gYXR0cmlidXRlczoKICAgICAgICByZXN1bHRbYXR0cl0gPSBtYXRjaGVkX2l0ZW0uZ2V0KGF0dHIpCgogICAgbG9nZ2luZy5kZWJ1ZygiW1BPU1QgL2VudGl0eV0gUmV0dXJuaW5nIGF0dHJpYnV0ZXM6ICVzIiwgcmVzdWx0KQogICAgcmV0dXJuIGpzb25pZnkoeyJyZXN1bHQiOiByZXN1bHQsICJzdGF0IjogIm9rIn0pCgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyAyKSBQT1NUIC9lbnRpdHkuZmluZAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpAYXBwLnJvdXRlKCcvZW50aXR5LmZpbmQnLCBtZXRob2RzPVsnUE9TVCddKQpkZWYgZW50aXR5X2ZpbmQoKToKICAgICIiIgogICAgUE9TVCAvZW50aXR5LmZpbmQ6CiAgICAxLiBSZWFkcyB0eXBlX25hbWUsIGZpbHRlciwgYXR0cmlidXRlcywgc29ydF9vbiBmcm9tIHRoZSByZXF1ZXN0IGJvZHkuCiAgICAyLiBGaWx0ZXJzIHRoZSBkYXRhIGJhc2VkIG9uIHNpbXBsZSAiYW5kIi1zZXBhcmF0ZWQga2V5PXZhbHVlIHBhaXJzIChuYWl2ZSBhcHByb2FjaCkuCiAgICAzLiBSZXR1cm5zIHRoZSBmaWx0ZXJlZCByZWNvcmRzIChvbmx5IHJlcXVlc3RlZCBhdHRyaWJ1dGVzKSBpbiBzb3J0ZWQgb3JkZXIuCiAgICAiIiIKICAgIGxvZ2dpbmcuZGVidWcoIj09PSBbUE9TVCAvZW50aXR5LmZpbmRdIEluY29taW5nIHJlcXVlc3QgPT09IikKICAgIGRhdGEgPSBnZXRfcmVxdWVzdF9kYXRhKCkKCiAgICB0eXBlX25hbWUgICA9IGRhdGEuZ2V0KCd0eXBlX25hbWUnKQogICAgZmlsdGVyX3N0ciAgPSBkYXRhLmdldCgnZmlsdGVyJywgJycpCiAgICBhdHRyaWJ1dGVzICA9IGRhdGEuZ2V0KCdhdHRyaWJ1dGVzJykKICAgIHNvcnRfb24gICAgID0gZGF0YS5nZXQoJ3NvcnRfb24nKQoKICAgIGxvZ2dpbmcuZGVidWcoIlBhcnNlZCBmaWVsZHMgLT4gdHlwZV9uYW1lOiAlcywgZmlsdGVyOiAlcywgYXR0cmlidXRlczogJXMsIHNvcnRfb246ICVzIiwKICAgICAgICAgICAgICAgICAgdHlwZV9uYW1lLCBmaWx0ZXJfc3RyLCBhdHRyaWJ1dGVzLCBzb3J0X29uKQoKICAgICMgQ29udmVydCBhdHRyaWJ1dGVzIGFuZCBzb3J0X29uIHdoaWNoIG1heSBiZSBKU09OIHN0cmluZ3Mgb3IgbGlzdHMKICAgIGlmIGlzaW5zdGFuY2UoYXR0cmlidXRlcywgc3RyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSBqc29uLmxvYWRzKGF0dHJpYnV0ZXMpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBhdHRyaWJ1dGVzID0gW10KICAgIGVsaWYgYXR0cmlidXRlcyBpcyBOb25lOgogICAgICAgIGF0dHJpYnV0ZXMgPSBbXQoKICAgIGlmIGlzaW5zdGFuY2Uoc29ydF9vbiwgc3RyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNvcnRfb24gPSBqc29uLmxvYWRzKHNvcnRfb24pCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBzb3J0X29uID0gW10KICAgIGVsaWYgc29ydF9vbiBpcyBOb25lOgogICAgICAgIHNvcnRfb24gPSBbXQoKICAgIGlmIG5vdCB0eXBlX25hbWUgb3IgdHlwZV9uYW1lIG5vdCBpbiBzdG9yZToKICAgICAgICBsb2dnaW5nLmRlYnVnKCJbUE9TVCAvZW50aXR5LmZpbmRdIHR5cGVfbmFtZSBtaXNzaW5nIG9yIG5vdCBmb3VuZCBpbiBzdG9yZS4iKQogICAgICAgIHJldHVybiBqc29uaWZ5KHsicmVzdWx0X2NvdW50IjogMCwgInJlc3VsdHMiOiBbXSwgInN0YXQiOiAib2sifSkKCiAgICBlbnRpdGllcyA9IHN0b3JlW3R5cGVfbmFtZV0KCiAgICAjIFBhcnNlIHRoZSBmaWx0ZXIgc3RyaW5nIChhIG5haXZlIGFwcHJvYWNoIHNwbGl0dGluZyBvbiAiIGFuZCAiKS4KICAgIGNyaXRlcmlhID0gW10KICAgIGlmIGZpbHRlcl9zdHI6CiAgICAgICAgcGFydHMgPSBmaWx0ZXJfc3RyLnNwbGl0KCIgYW5kICIpCiAgICAgICAgZm9yIHBhcnQgaW4gcGFydHM6CiAgICAgICAgICAgIGlmICI9IiBpbiBwYXJ0OgogICAgICAgICAgICAgICAgbGVmdCwgcmlnaHQgPSBwYXJ0LnNwbGl0KCI9IiwgMSkKICAgICAgICAgICAgICAgIGxlZnQgPSBsZWZ0LnN0cmlwKCkKICAgICAgICAgICAgICAgIHJpZ2h0ID0gcmlnaHQuc3RyaXAoKS5zdHJpcCgiJyIpCiAgICAgICAgICAgICAgICBjcml0ZXJpYS5hcHBlbmQoKGxlZnQsIHJpZ2h0KSkKCiAgICBsb2dnaW5nLmRlYnVnKCJGaWx0ZXIgY3JpdGVyaWEgcGFyc2VkIC0+ICVzIiwgY3JpdGVyaWEpCgogICAgZGVmIG1hdGNoZXNfZmlsdGVyKGVudGl0eSk6CiAgICAgICAgIiIiCiAgICAgICAgQ2hlY2tzIGlmIGEgc2luZ2xlIGVudGl0eSBtYXRjaGVzIGFsbCAoZmllbGRfcGF0aCwgZXhwZWN0ZWRfdmFsdWUpIHBhaXJzLgogICAgICAgIEV4YW1wbGUgb2YgZmllbGRfcGF0aCBtaWdodCBiZSAicHJpbWFyeUFkZHJlc3MuY29tcGFueSIuCiAgICAgICAgIiIiCiAgICAgICAgZm9yIChmaWVsZF9wYXRoLCBleHBlY3RlZF92YWx1ZSkgaW4gY3JpdGVyaWE6CiAgICAgICAgICAgIHBhcnRzID0gZmllbGRfcGF0aC5zcGxpdCgiLiIpCiAgICAgICAgICAgIHRtcF92YWwgPSBlbnRpdHkKICAgICAgICAgICAgZm9yIHAgaW4gcGFydHM6CiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHRtcF92YWwsIGRpY3QpIGFuZCBwIGluIHRtcF92YWw6CiAgICAgICAgICAgICAgICAgICAgdG1wX3ZhbCA9IHRtcF92YWxbcF0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGlmIHN0cih0bXBfdmFsKSAhPSBleHBlY3RlZF92YWx1ZToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHJldHVybiBUcnVlCgogICAgIyBGaWx0ZXIgdGhlIGVudGl0aWVzCiAgICBmaWx0ZXJlZCA9IFtlIGZvciBlIGluIGVudGl0aWVzIGlmIG1hdGNoZXNfZmlsdGVyKGUpXQogICAgbG9nZ2luZy5kZWJ1ZygiRmlsdGVyZWQgcmVzdWx0cyAoYmVmb3JlIHNvcnQpOiAlcyIsIGZpbHRlcmVkKQoKICAgICMgU29ydCByZXN1bHRzIGlmIHNvcnRfb24gbGlzdCB3YXMgcHJvdmlkZWQKICAgIGZvciBhdHRyIGluIHJldmVyc2VkKHNvcnRfb24pOgogICAgICAgIGZpbHRlcmVkLnNvcnQoa2V5PWxhbWJkYSB4OiB4LmdldChhdHRyLCAnJykpCgogICAgIyBCdWlsZCB0aGUgZmluYWwgcmVzdWx0cyB3aXRoIG9ubHkgcmVxdWVzdGVkIGF0dHJpYnV0ZXMKICAgIHJlc3VsdHMgPSBbXQogICAgZm9yIGl0ZW0gaW4gZmlsdGVyZWQ6CiAgICAgICAgcmVzdWx0X2l0ZW0gPSB7fQogICAgICAgIGZvciBhdHRyIGluIGF0dHJpYnV0ZXM6CiAgICAgICAgICAgIHJlc3VsdF9pdGVtW2F0dHJdID0gaXRlbS5nZXQoYXR0cikKICAgICAgICByZXN1bHRzLmFwcGVuZChyZXN1bHRfaXRlbSkKCiAgICBsb2dnaW5nLmRlYnVnKCJbUE9TVCAvZW50aXR5LmZpbmRdIEZvdW5kICVkIHJlc3VsdHMuIFJldHVybmluZyBzdWJzZXQgb2YgYXR0cmlidXRlcy4iLCBsZW4ocmVzdWx0cykpCgogICAgcmV0dXJuIGpzb25pZnkoewogICAgICAgICJyZXN1bHRfY291bnQiOiBsZW4ocmVzdWx0cyksCiAgICAgICAgInJlc3VsdHMiOiByZXN1bHRzLAogICAgICAgICJzdGF0IjogIm9rIgogICAgfSkKCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIDMpIFBPU1QgL2VudGl0eS5jb3VudAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpAYXBwLnJvdXRlKCcvZW50aXR5LmNvdW50JywgbWV0aG9kcz1bJ1BPU1QnXSkKZGVmIGVudGl0eV9jb3VudCgpOgogICAgIiIiCiAgICBQT1NUIC9lbnRpdHkuY291bnQ6CiAgICAtIFNpbXBseSBjb3VudHMgdGhlIHRvdGFsIG51bWJlciBvZiBlbnRpdGllcyBhY3Jvc3MgYWxsIHR5cGVzIGluICdzdG9yZScuCiAgICAtIE9wdGlvbmFsbHksIGNvdWxkIGFjY2VwdCBhIHR5cGVfbmFtZSBpZiBuZWVkZWQsIGJ1dCBjdXJyZW50bHkgZG9lc24ndC4KICAgIC0gUmV0dXJucyB7InRvdGFsX2NvdW50IjogTiwgInN0YXQiOiAib2sifS4KICAgICIiIgogICAgbG9nZ2luZy5kZWJ1ZygiPT09IFtQT1NUIC9lbnRpdHkuY291bnRdIEluY29taW5nIHJlcXVlc3QgPT09IikKICAgIGRhdGEgPSBnZXRfcmVxdWVzdF9kYXRhKCkgICMgTm90IHVzZWQgaW4gdGhpcyBtaW5pbWFsIGV4YW1wbGUsIGJ1dCBtaWdodCBiZSBuZWVkZWQgbGF0ZXIKCiAgICB0b3RhbF9jb3VudCA9IHN1bShsZW4oaXRlbXMpIGZvciBpdGVtcyBpbiBzdG9yZS52YWx1ZXMoKSkKICAgIGxvZ2dpbmcuZGVidWcoIltQT1NUIC9lbnRpdHkuY291bnRdIFRvdGFsIGVudGl0eSBjb3VudDogJWQiLCB0b3RhbF9jb3VudCkKCiAgICByZXR1cm4ganNvbmlmeSh7CiAgICAgICAgInRvdGFsX2NvdW50IjogdG90YWxfY291bnQsCiAgICAgICAgInN0YXQiOiAib2siCiAgICB9KQoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgNCkgUE9TVCAvZW50aXR5LnVwZGF0ZQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpAYXBwLnJvdXRlKCcvZW50aXR5LnVwZGF0ZScsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBlbnRpdHlfdXBkYXRlKCk6CiAgICAiIiIKICAgIFBPU1QgL2VudGl0eS51cGRhdGU6CiAgICAtIFJlYWRzIHR5cGVfbmFtZSwga2V5X2F0dHJpYnV0ZSwga2V5X3ZhbHVlLCB1cGRhdGVzIGZyb20gdGhlIHJlcXVlc3QgYm9keS4KICAgIC0gTG9jYXRlcyB0aGUgZmlyc3QgbWF0Y2hpbmcgZW50aXR5IGFuZCBhcHBsaWVzIHRoZSBrZXktdmFsdWUgcGFpcnMgaW4gJ3VwZGF0ZXMnLgogICAgLSBSZXR1cm5zIHsic3RhdCI6ICJvayJ9IHdoZXRoZXIgaXQgdXBkYXRlcyBvciBub3QuCiAgICAiIiIKICAgIGxvZ2dpbmcuZGVidWcoIj09PSBbUE9TVCAvZW50aXR5LnVwZGF0ZV0gSW5jb21pbmcgcmVxdWVzdCA9PT0iKQogICAgZGF0YSA9IGdldF9yZXF1ZXN0X2RhdGEoKQoKICAgIHR5cGVfbmFtZSAgPSBkYXRhLmdldCgndHlwZV9uYW1lJykKICAgIGtleV9hdHRyICAgPSBkYXRhLmdldCgna2V5X2F0dHJpYnV0ZScpCiAgICBrZXlfdmFsdWUgID0gZGF0YS5nZXQoJ2tleV92YWx1ZScpCiAgICB1cGRhdGVzICAgID0gZGF0YS5nZXQoJ3VwZGF0ZXMnKQoKICAgIGxvZ2dpbmcuZGVidWcoIlBhcnNlZCBmaWVsZHMgLT4gdHlwZV9uYW1lOiAlcywga2V5X2F0dHI6ICVzLCBrZXlfdmFsdWU6ICVzLCB1cGRhdGVzOiAlcyIsCiAgICAgICAgICAgICAgICAgIHR5cGVfbmFtZSwga2V5X2F0dHIsIGtleV92YWx1ZSwgdXBkYXRlcykKCiAgICAjIHVwZGF0ZXMgbWlnaHQgYmUgYSBKU09OIHN0cmluZyBvciBhIGRpY3QKICAgIGlmIGlzaW5zdGFuY2UodXBkYXRlcywgc3RyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVwZGF0ZXMgPSBqc29uLmxvYWRzKHVwZGF0ZXMpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICB1cGRhdGVzID0ge30KICAgIGVsaWYgdXBkYXRlcyBpcyBOb25lOgogICAgICAgIHVwZGF0ZXMgPSB7fQoKICAgIGlmIG5vdCB0eXBlX25hbWUgb3IgdHlwZV9uYW1lIG5vdCBpbiBzdG9yZToKICAgICAgICBsb2dnaW5nLmRlYnVnKCJbUE9TVCAvZW50aXR5LnVwZGF0ZV0gdHlwZV9uYW1lIG1pc3Npbmcgb3Igbm90IGluIHN0b3JlOiAlcyIsIHR5cGVfbmFtZSkKICAgICAgICByZXR1cm4ganNvbmlmeSh7InN0YXQiOiAib2sifSkKCiAgICAjIFN0cmlwIGV4dHJhIHF1b3RlcyBmcm9tIGtleV92YWx1ZSBpZiBwcmVzZW50CiAgICBpZiBpc2luc3RhbmNlKGtleV92YWx1ZSwgc3RyKSBhbmQga2V5X3ZhbHVlLnN0YXJ0c3dpdGgoJyInKSBhbmQga2V5X3ZhbHVlLmVuZHN3aXRoKCciJyk6CiAgICAgICAga2V5X3ZhbHVlID0ga2V5X3ZhbHVlLnN0cmlwKCciJykKCiAgICB1cGRhdGVkID0gRmFsc2UKICAgIGZvciBpdGVtIGluIHN0b3JlW3R5cGVfbmFtZV06CiAgICAgICAgaWYgc3RyKGl0ZW0uZ2V0KGtleV9hdHRyLCAnJykpID09IHN0cihrZXlfdmFsdWUpOgogICAgICAgICAgICBsb2dnaW5nLmRlYnVnKCJNYXRjaGluZyBpdGVtIGZvdW5kOiAlcywgYXBwbHlpbmcgdXBkYXRlczogJXMiLCBpdGVtLCB1cGRhdGVzKQogICAgICAgICAgICBmb3IgaywgdiBpbiB1cGRhdGVzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpdGVtW2tdID0gdgogICAgICAgICAgICB1cGRhdGVkID0gVHJ1ZQogICAgICAgICAgICBicmVhawoKICAgIGlmIHVwZGF0ZWQ6CiAgICAgICAgc2F2ZV9kYXRhKHN0b3JlKQogICAgICAgIGxvZ2dpbmcuZGVidWcoIltQT1NUIC9lbnRpdHkudXBkYXRlXSBEYXRhIHVwZGF0ZWQgYW5kIHNhdmVkLiIpCiAgICBlbHNlOgogICAgICAgIGxvZ2dpbmcuZGVidWcoIltQT1NUIC9lbnRpdHkudXBkYXRlXSBObyBtYXRjaGluZyBpdGVtIGZvdW5kLCBubyB1cGRhdGUgcGVyZm9ybWVkLiIpCgogICAgcmV0dXJuIGpzb25pZnkoeyJzdGF0IjogIm9rIn0pCgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyA1KSBQT1NUIC9lbnRpdHkuY3JlYXRlCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCkBhcHAucm91dGUoJy9lbnRpdHkuY3JlYXRlJywgbWV0aG9kcz1bJ1BPU1QnXSkKZGVmIGVudGl0eV9jcmVhdGUoKToKICAgICIiIgogICAgUE9TVCAvZW50aXR5LmNyZWF0ZToKICAgIDEuIFJlYWRzIHR5cGVfbmFtZSwgYXR0cmlidXRlcy4KICAgIDIuIEdlbmVyYXRlcyBhIG5ldyBJRCAobWF4KzEgaW4gdGhlIGxpc3QpIGFuZCBhIG5ldyBVVUlELgogICAgMy4gQ3JlYXRlcyB0aGUgbmV3IGVudGl0eSBhbmQgc2F2ZXMgaXQgaW4gc3RvcmVbdHlwZV9uYW1lXS4KICAgIDQuIFJldHVybnMgeyJpZCI6IDxuZXdfaWQ+LCAic3RhdCI6ICJvayIsICJ1dWlkIjogPG5ld191dWlkPn0uCiAgICAiIiIKICAgIGxvZ2dpbmcuZGVidWcoIj09PSBbUE9TVCAvZW50aXR5LmNyZWF0ZV0gSW5jb21pbmcgcmVxdWVzdCA9PT0iKQogICAgZGF0YSA9IGdldF9yZXF1ZXN0X2RhdGEoKQoKICAgIHR5cGVfbmFtZSAgPSBkYXRhLmdldCgndHlwZV9uYW1lJykKICAgIGF0dHJpYnV0ZXMgPSBkYXRhLmdldCgnYXR0cmlidXRlcycpCgogICAgbG9nZ2luZy5kZWJ1ZygiUGFyc2VkIGZpZWxkcyAtPiB0eXBlX25hbWU6ICVzLCBhdHRyaWJ1dGVzOiAlcyIsIHR5cGVfbmFtZSwgYXR0cmlidXRlcykKCiAgICAjIGF0dHJpYnV0ZXMgbWlnaHQgYmUgYSBKU09OIHN0cmluZyBvciBhIGRpY3QKICAgIGlmIGlzaW5zdGFuY2UoYXR0cmlidXRlcywgc3RyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSBqc29uLmxvYWRzKGF0dHJpYnV0ZXMpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBhdHRyaWJ1dGVzID0ge30KICAgIGVsaWYgYXR0cmlidXRlcyBpcyBOb25lOgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQoKICAgIGlmIG5vdCB0eXBlX25hbWU6CiAgICAgICAgbG9nZ2luZy5kZWJ1ZygiW1BPU1QgL2VudGl0eS5jcmVhdGVdIHR5cGVfbmFtZSBtaXNzaW5nLCByZXR1cm5pbmcgZGVmYXVsdCByZXNwb25zZS4iKQogICAgICAgIHJldHVybiBqc29uaWZ5KHsiaWQiOiBOb25lLCAic3RhdCI6ICJvayIsICJ1dWlkIjogIiJ9KQoKICAgIGlmIHR5cGVfbmFtZSBub3QgaW4gc3RvcmU6CiAgICAgICAgc3RvcmVbdHlwZV9uYW1lXSA9IFtdCgogICAgZXhpc3RpbmdfaWRzID0gW2l0ZW0uZ2V0KCdpZCcsIDApIGZvciBpdGVtIGluIHN0b3JlW3R5cGVfbmFtZV1dCiAgICBtYXhfaWQgPSBtYXgoZXhpc3RpbmdfaWRzKSBpZiBleGlzdGluZ19pZHMgZWxzZSAwCiAgICBuZXdfaWQgPSBtYXhfaWQgKyAxCgogICAgbmV3X3V1aWQgPSBzdHIodXVpZC51dWlkNCgpKQoKICAgIG5ld19lbnRpdHkgPSB7CiAgICAgICAgImlkIjogbmV3X2lkLAogICAgICAgICJ1dWlkIjogbmV3X3V1aWQKICAgIH0KICAgIG5ld19lbnRpdHkudXBkYXRlKGF0dHJpYnV0ZXMpCgogICAgc3RvcmVbdHlwZV9uYW1lXS5hcHBlbmQobmV3X2VudGl0eSkKICAgIHNhdmVfZGF0YShzdG9yZSkKCiAgICBsb2dnaW5nLmRlYnVnKCJbUE9TVCAvZW50aXR5LmNyZWF0ZV0gQ3JlYXRlZCBlbnRpdHkgd2l0aCBpZD0lZCwgdXVpZD0lcyIsIG5ld19pZCwgbmV3X3V1aWQpCgogICAgcmV0dXJuIGpzb25pZnkoewogICAgICAgICJpZCI6IG5ld19pZCwKICAgICAgICAic3RhdCI6ICJvayIsCiAgICAgICAgInV1aWQiOiBuZXdfdXVpZAogICAgfSkKCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIDYpIFBPU1QgL2VudGl0eS5kZWxldGUKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KQGFwcC5yb3V0ZSgnL2VudGl0eS5kZWxldGUnLCBtZXRob2RzPVsnUE9TVCddKQpkZWYgZW50aXR5X2RlbGV0ZSgpOgogICAgIiIiCiAgICBQT1NUIC9lbnRpdHkuZGVsZXRlOgogICAgMS4gUmVhZHMgdHlwZV9uYW1lLCBrZXlfYXR0cmlidXRlLCBrZXlfdmFsdWUgZnJvbSB0aGUgcmVxdWVzdCBib2R5LgogICAgMi4gRGVsZXRlcyB0aGUgKmZpcnN0KiBtYXRjaGluZyBpdGVtIGluIHN0b3JlW3R5cGVfbmFtZV0uCiAgICAzLiBTYXZlcyB0aGUgdXBkYXRlZCBzdG9yZSB0byBkYXRhLmpzb24gaWYgYW4gaXRlbSB3YXMgZGVsZXRlZC4KICAgIDQuIFJldHVybnMgeyJzdGF0IjogIm9rIn0gYWx3YXlzLgogICAgIiIiCiAgICBsb2dnaW5nLmRlYnVnKCI9PT0gW1BPU1QgL2VudGl0eS5kZWxldGVdIEluY29taW5nIHJlcXVlc3QgPT09IikKICAgIGRhdGEgPSBnZXRfcmVxdWVzdF9kYXRhKCkKICAgIGxvZ2dpbmcuZGVidWcoIkRFQlVHIC0gSW5jb21pbmcgZGF0YTogJXMiLCBkYXRhKQoKICAgIHR5cGVfbmFtZSA9IGRhdGEuZ2V0KCd0eXBlX25hbWUnKQogICAga2V5X2F0dHIgID0gZGF0YS5nZXQoJ2tleV9hdHRyaWJ1dGUnKQogICAga2V5X3ZhbHVlID0gZGF0YS5nZXQoJ2tleV92YWx1ZScpCgogICAgbG9nZ2luZy5kZWJ1ZygiREVCVUcgLSBDaGVja2luZyBmb3IgdHlwZTogJXMsIGtleV9hdHRyOiAlcywga2V5X3ZhbHVlOiAlcyIsCiAgICAgICAgICAgICAgICAgIHR5cGVfbmFtZSwga2V5X2F0dHIsIGtleV92YWx1ZSkKCiAgICBpZiBub3QgdHlwZV9uYW1lIG9yIHR5cGVfbmFtZSBub3QgaW4gc3RvcmU6CiAgICAgICAgbG9nZ2luZy5kZWJ1ZygiREVCVUcgLSB0eXBlX25hbWUgbWlzc2luZyBvciBub3QgaW4gc3RvcmU6ICVzIiwgdHlwZV9uYW1lKQogICAgICAgIHJldHVybiBqc29uaWZ5KHsic3RhdCI6ICJvayJ9KQoKICAgIGlmIGlzaW5zdGFuY2Uoa2V5X3ZhbHVlLCBzdHIpIGFuZCBrZXlfdmFsdWUuc3RhcnRzd2l0aCgnIicpIGFuZCBrZXlfdmFsdWUuZW5kc3dpdGgoJyInKToKICAgICAgICBrZXlfdmFsdWUgPSBrZXlfdmFsdWUuc3RyaXAoJyInKQoKICAgIG5ld19saXN0ID0gW10KICAgIGRlbGV0ZWQgPSBGYWxzZQoKICAgIGZvciBpdGVtIGluIHN0b3JlW3R5cGVfbmFtZV06CiAgICAgICAgbG9nZ2luZy5kZWJ1ZygiREVCVUcgLSBDaGVja2luZyBpdGVtOiAlcyIsIGl0ZW0pCiAgICAgICAgaWYgc3RyKGl0ZW0uZ2V0KGtleV9hdHRyLCAnJykpID09IHN0cihrZXlfdmFsdWUpIGFuZCBub3QgZGVsZXRlZDoKICAgICAgICAgICAgbG9nZ2luZy5kZWJ1ZygiREVCVUcgLSBGb3VuZCBtYXRjaCEgRGVsZXRpbmc6ICVzIiwgaXRlbSkKICAgICAgICAgICAgZGVsZXRlZCA9IFRydWUKICAgICAgICAgICAgIyBTa2lwIGFkZGluZyB0aGlzIHRvIG5ld19saXN0IChpLmUuLCB3ZSAiZGVsZXRlIiBpdCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBuZXdfbGlzdC5hcHBlbmQoaXRlbSkKCiAgICBzdG9yZVt0eXBlX25hbWVdID0gbmV3X2xpc3QKCiAgICBpZiBkZWxldGVkOgogICAgICAgIHNhdmVfZGF0YShzdG9yZSkKICAgICAgICBsb2dnaW5nLmRlYnVnKCJERUJVRyAtIERlbGV0ZWQgaXRlbSBhbmQgc2F2ZWQgZGF0YS4iKQogICAgZWxzZToKICAgICAgICBsb2dnaW5nLmRlYnVnKCJERUJVRyAtIE5vIG1hdGNoaW5nIGl0ZW0gZm91bmQsIG5vdGhpbmcgZGVsZXRlZC4iKQoKICAgIHJldHVybiBqc29uaWZ5KHsic3RhdCI6ICJvayJ9KQoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgTUFJTiBFTlRSWSBQT0lOVAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgIyBSdW5uaW5nIEZsYXNrIGRpcmVjdGx5LiBFbnN1cmUgdGhlIC9hcHAvbG9ncyBmb2xkZXIgZXhpc3RzIGZvciBhcHAubG9nIGlmIG5lZWRlZC4KICAgIG9zLm1ha2VkaXJzKCcvYXBwL2xvZ3MnLCBleGlzdF9vaz1UcnVlKQogICAgbG9nZ2luZy5kZWJ1ZygiU3RhcnRpbmcgRmxhc2sgYXBwIG9uIDAuMC4wLjA6NTAwMC4iKQogICAgYXBwLnJ1bihob3N0PScwLjAuMC4wJywgcG9ydD01MDAwLCBkZWJ1Zz1UcnVlKQo=
  
  data.json: ewogICAgInVzZXIiOiBbCiAgICAgICAgewogICAgICAgICAgICAiYWNjb3VudERhdGFSZXF1ZXN0VGltZSI6IG51bGwsCiAgICAgICAgICAgICJhY2NvdW50RGVsZXRlUmVxdWVzdFRpbWUiOiBudWxsLAogICAgICAgICAgICAiYmlydGhkYXkiOiBudWxsLAogICAgICAgICAgICAiY2xpZW50cyI6IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAic3RwY2pwbnZyanM1bnUybW1oY2p4eWZoeWZzNXRhaDkiLAogICAgICAgICAgICAgICAgImZpcnN0TG9naW4iOiAiMjAyNS0wMS0yMSAxMTowNzowNSArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3NjkwMjYsCiAgICAgICAgICAgICAgICAibGFzdExvZ2luIjogIjIwMjUtMDEtMjEgMTE6MDc6MDUgKzAwMDAiLAogICAgICAgICAgICAgICAgIm5hbWUiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAiYzNxdWVoZHFxazZoOHp4M3dwNGt1YnZqa2tjanZjcDIiLAogICAgICAgICAgICAgICAgImZpcnN0TG9naW4iOiAiMjAyNS0wMS0yMSAxMToxMzo1MCArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3Njk3OTMsCiAgICAgICAgICAgICAgICAibGFzdExvZ2luIjogIjIwMjUtMDEtMjEgMTE6NDY6MTkgKzAwMDAiLAogICAgICAgICAgICAgICAgIm5hbWUiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAia2VzcjlueXZ1ajZyazdnNWthZjcyYnVkNjl1cG45MzUiLAogICAgICAgICAgICAgICAgImZpcnN0TG9naW4iOiAiMjAyNS0wMS0yMSAxMTozOToyMiArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3NzAzMDUsCiAgICAgICAgICAgICAgICAibGFzdExvZ2luIjogIjIwMjUtMDEtMjEgMTU6MjE6MzEgKzAwMDAiLAogICAgICAgICAgICAgICAgIm5hbWUiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAiYXJ4ZXl2dDI4a3E5YXhmZHdjbnN5ZzR6MmZ3d3J0ZjkiLAogICAgICAgICAgICAgICAgImZpcnN0TG9naW4iOiAiMjAyNS0wMS0yMSAxMTo0MDozNSArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3NzA0MzUsCiAgICAgICAgICAgICAgICAibGFzdExvZ2luIjogIjIwMjUtMDEtMjEgMTE6NDA6MzUgKzAwMDAiLAogICAgICAgICAgICAgICAgIm5hbWUiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAianR3OWJhazgzeHQzang4Yzk1dHVkcHU1cXJoZG0za2YiLAogICAgICAgICAgICAgICAgImZpcnN0TG9naW4iOiAiMjAyNS0wMS0yMSAxMjo1OToyMyArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3NzA5NDUsCiAgICAgICAgICAgICAgICAibGFzdExvZ2luIjogIjIwMjUtMDEtMjEgMTI6NTk6MjMgKzAwMDAiLAogICAgICAgICAgICAgICAgIm5hbWUiOiBudWxsCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAiY29uc2VudHMiOiB7CiAgICAgICAgICAgICAgImNvbW11bmljYXRpb24iOiB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiBudWxsLAogICAgICAgICAgICAgICAgImNvbnRleHQiOiBudWxsLAogICAgICAgICAgICAgICAgImdyYW50ZWQiOiBudWxsLAogICAgICAgICAgICAgICAgInR5cGUiOiBudWxsLAogICAgICAgICAgICAgICAgInVwZGF0ZWQiOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAiY29va2llcyI6IHsKICAgICAgICAgICAgICAgICJjbGllbnRJZCI6IG51bGwsCiAgICAgICAgICAgICAgICAiY29udGV4dCI6IG51bGwsCiAgICAgICAgICAgICAgICAiZ3JhbnRlZCI6IG51bGwsCiAgICAgICAgICAgICAgICAidHlwZSI6IG51bGwsCiAgICAgICAgICAgICAgICAidXBkYXRlZCI6IG51bGwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJkYXRhIjogewogICAgICAgICAgICAgICAgImNsaWVudElkIjogbnVsbCwKICAgICAgICAgICAgICAgICJjb250ZXh0IjogbnVsbCwKICAgICAgICAgICAgICAgICJncmFudGVkIjogbnVsbCwKICAgICAgICAgICAgICAgICJ0eXBlIjogbnVsbCwKICAgICAgICAgICAgICAgICJ1cGRhdGVkIjogbnVsbAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgIm1hcmtldGluZyI6IHsKICAgICAgICAgICAgICAgICJjbGllbnRJZCI6IG51bGwsCiAgICAgICAgICAgICAgICAiY29udGV4dCI6IG51bGwsCiAgICAgICAgICAgICAgICAiZ3JhbnRlZCI6IG51bGwsCiAgICAgICAgICAgICAgICAidHlwZSI6IG51bGwsCiAgICAgICAgICAgICAgICAidXBkYXRlZCI6IG51bGwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJwZXJzb25hbGl6YXRpb24iOiB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiBudWxsLAogICAgICAgICAgICAgICAgImNvbnRleHQiOiBudWxsLAogICAgICAgICAgICAgICAgImdyYW50ZWQiOiBudWxsLAogICAgICAgICAgICAgICAgInR5cGUiOiBudWxsLAogICAgICAgICAgICAgICAgInVwZGF0ZWQiOiBudWxsCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAiY3JlYXRlZCI6ICIyMDI1LTAxLTIxIDExOjA3OjA1LjE5ODMyNyArMDAwMCIsCiAgICAgICAgICAgICJkZWFjdGl2YXRlQWNjb3VudCI6IG51bGwsCiAgICAgICAgICAgICJkaXNwbGF5IjogbnVsbCwKICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogbnVsbCwKICAgICAgICAgICAgImVtYWlsIjogImxpdml1NXRlc3RzQGdtYWlsLmNvbSIsCiAgICAgICAgICAgICJlbWFpbFZlcmlmaWVkIjogIjIwMjUtMDEtMjEgMTE6MDc6MDUuMTkzICswMDAwIiwKICAgICAgICAgICAgImV4dGVybmFsSWQiOiBudWxsLAogICAgICAgICAgICAiZmFtaWx5TmFtZSI6ICJGaXZlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogbnVsbCwKICAgICAgICAgICAgImdlbmRlciI6IG51bGwsCiAgICAgICAgICAgICJnaXZlbk5hbWUiOiAiTGl2aXUiLAogICAgICAgICAgICAiaWQiOiA3Njc3NjkwMjUsCiAgICAgICAgICAgICJsYXN0TG9naW4iOiAiMjAyNS0wMS0yMSAxNToyMTozMSArMDAwMCIsCiAgICAgICAgICAgICJsYXN0TG9naW5XaXRoIjogInRyYWRpdGlvbmFsIiwKICAgICAgICAgICAgImxhc3RVcGRhdGVkIjogIjIwMjUtMDEtMjEgMTU6MjE6MzEuNjgyNjMgKzAwMDAiLAogICAgICAgICAgICAibGVnYWxBY2NlcHRhbmNlcyI6IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAic3RwY2pwbnZyanM1bnUybW1oY2p4eWZoeWZzNXRhaDkiLAogICAgICAgICAgICAgICAgImRhdGVBY2NlcHRlZCI6ICIyMDI1LTAxLTIxIDExOjA3OjA1ICswMDAwIiwKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc2OTAyNywKICAgICAgICAgICAgICAgICJsZWdhbEFjY2VwdGFuY2VJZCI6ICJwcml2YWN5UG9saWN5LXBicy12ZXJtb250LXB1YmxpYy12MSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJjbGllbnRJZCI6ICJzdHBjanBudnJqczVudTJtbWhjanh5Zmh5ZnM1dGFoOSIsCiAgICAgICAgICAgICAgICAiZGF0ZUFjY2VwdGVkIjogIjIwMjUtMDEtMjEgMTE6MDc6MDUgKzAwMDAiLAogICAgICAgICAgICAgICAgImlkIjogNzY3NzY5MDI4LAogICAgICAgICAgICAgICAgImxlZ2FsQWNjZXB0YW5jZUlkIjogInRlcm1zT2ZTZXJ2aWNlLXBicy12ZXJtb250LXB1YmxpYy12MSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJjbGllbnRJZCI6ICJjM3F1ZWhkcXFrNmg4engzd3A0a3Vidmpra2NqdmNwMiIsCiAgICAgICAgICAgICAgICAiZGF0ZUFjY2VwdGVkIjogIjIwMjUtMDEtMjEgMTE6MTM6NTAgKzAwMDAiLAogICAgICAgICAgICAgICAgImlkIjogNzY3NzY5Nzk0LAogICAgICAgICAgICAgICAgImxlZ2FsQWNjZXB0YW5jZUlkIjogInByaXZhY3lQb2xpY3ktbnByLXYxIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImNsaWVudElkIjogImMzcXVlaGRxcWs2aDh6eDN3cDRrdWJ2amtrY2p2Y3AyIiwKICAgICAgICAgICAgICAgICJkYXRlQWNjZXB0ZWQiOiAiMjAyNS0wMS0yMSAxMToxMzo1MCArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3Njk3OTUsCiAgICAgICAgICAgICAgICAibGVnYWxBY2NlcHRhbmNlSWQiOiAidGVybXNPZlNlcnZpY2UtbnByLXYxIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImNsaWVudElkIjogImtlc3I5bnl2dWo2cms3ZzVrYWY3MmJ1ZDY5dXBuOTM1IiwKICAgICAgICAgICAgICAgICJkYXRlQWNjZXB0ZWQiOiAiMjAyNS0wMS0yMSAxMTozOToyNSArMDAwMCIsCiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3NzA0MzMsCiAgICAgICAgICAgICAgICAibGVnYWxBY2NlcHRhbmNlSWQiOiAicHJpdmFjeVBvbGljeS1wYnMtdjEiCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY2xpZW50SWQiOiAia2VzcjlueXZ1ajZyazdnNWthZjcyYnVkNjl1cG45MzUiLAogICAgICAgICAgICAgICAgImRhdGVBY2NlcHRlZCI6ICIyMDI1LTAxLTIxIDExOjM5OjI1ICswMDAwIiwKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc3MDQzNCwKICAgICAgICAgICAgICAgICJsZWdhbEFjY2VwdGFuY2VJZCI6ICJ0ZXJtc09mU2VydmljZS1wYnMtdjEiCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAibWlkZGxlTmFtZSI6IG51bGwsCiAgICAgICAgICAgICJtb2JpbGVOdW1iZXIiOiBudWxsLAogICAgICAgICAgICAibW9iaWxlTnVtYmVyVmVyaWZpZWQiOiBudWxsLAogICAgICAgICAgICAicGFzc3dvcmQiOiB7CiAgICAgICAgICAgICAgImNyZWF0ZWQiOiAiMjAyNS0wMS0yMSAxMTozNjoxNC42MzAzMjE3NDQgKzAwMDAiLAogICAgICAgICAgICAgICJ0eXBlIjogInBhc3N3b3JkLWJjcnlwdCIsCiAgICAgICAgICAgICAgInZhbHVlIjogIiQyYiQxMCRLZWNoSHkwZDZDaVFQb0RFdWZBTlN1NlNXZGlYck82cTU1YVFUSG5pcmlCV2gvUGxubmxxYSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInBob3RvcyI6IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiaWQiOiA3Njc3NjkwMjksCiAgICAgICAgICAgICAgICAidHlwZSI6ICJvdGhlciIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiAiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jTHh3OVhod1pGMWhoa1RPMUotaG1MVXB6TWJ5ajI5RnVfOFdSdF9CdXJ2OGltRz1zOTYtYyIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc2OTAzMCwKICAgICAgICAgICAgICAgICJ0eXBlIjogIm9yaWdpbmFsIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NMeHc5WGh3WkYxaGhrVE8xSi1obUxVcHpNYnlqMjlGdV84V1J0X0J1cnY4aW1HPXM5Ni1jIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImlkIjogNzY3NzY5MDMxLAogICAgICAgICAgICAgICAgInR5cGUiOiAibGFyZ2UiLAogICAgICAgICAgICAgICAgInZhbHVlIjogImh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0x4dzlYaHdaRjFoaGtUTzFKLWhtTFVwek1ieWoyOUZ1XzhXUnRfQnVydjhpbUc9czk2LWMiCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAicHJpbWFyeUFkZHJlc3MiOiB7CiAgICAgICAgICAgICAgImFkZHJlc3MxIjogbnVsbCwKICAgICAgICAgICAgICAiYWRkcmVzczIiOiBudWxsLAogICAgICAgICAgICAgICJjaXR5IjogbnVsbCwKICAgICAgICAgICAgICAiY29tcGFueSI6IG51bGwsCiAgICAgICAgICAgICAgImNvdW50cnkiOiBudWxsLAogICAgICAgICAgICAgICJwaG9uZSI6IG51bGwsCiAgICAgICAgICAgICAgInN0YXRlQWJicmV2aWF0aW9uIjogbnVsbCwKICAgICAgICAgICAgICAiemlwIjogbnVsbCwKICAgICAgICAgICAgICAiemlwUGx1czQiOiBudWxsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJwcm9maWxlcyI6IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiZG9tYWluIjogImdvb2dsZS5jb20iLAogICAgICAgICAgICAgICAgImlkIjogNzY3NzY5MDMyLAogICAgICAgICAgICAgICAgImlkZW50aWZpZXIiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9wcm9maWxlcy8xMDM0NjA4MTIzNDc4MDU3NjM3MjciLAogICAgICAgICAgICAgICAgInBob3RvIjogImh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0x4dzlYaHdaRjFoaGtUTzFKLWhtTFVwek1ieWoyOUZ1XzhXUnRfQnVydjhpbUc9czk2LWMiLAogICAgICAgICAgICAgICAgInByb3ZpZGVyU3BlY2lmaWVyIjogImdvb2dsZSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJkb21haW4iOiAiYXBwbGUuY29tIiwKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc2OTE1MywKICAgICAgICAgICAgICAgICJpZGVudGlmaWVyIjogImh0dHBzOi8vYXBwbGVpZC5hcHBsZS5jb20vMDAwNDIwLmNkNzZiZjRmNjg0ODRmMjdiNzAyMDVmYjg3NTA0ODZjLjEyMjEiLAogICAgICAgICAgICAgICAgInBob3RvIjogbnVsbCwKICAgICAgICAgICAgICAgICJwcm92aWRlclNwZWNpZmllciI6ICJhcHBsZSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJkb21haW4iOiAiZmFjZWJvb2suY29tIiwKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc2OTY2NSwKICAgICAgICAgICAgICAgICJpZGVudGlmaWVyIjogImh0dHA6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTUzMjA3ODEyOTE0OTczMSIsCiAgICAgICAgICAgICAgICAicGhvdG8iOiAiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIuMC81MzIwNzgxMjkxNDk3MzEvcGljdHVyZT90eXBlPWxhcmdlIiwKICAgICAgICAgICAgICAgICJwcm92aWRlclNwZWNpZmllciI6ICJmYWNlYm9vayIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJkb21haW4iOiAiZmFjZWJvb2suY29tIiwKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc3MDU2MSwKICAgICAgICAgICAgICAgICJpZGVudGlmaWVyIjogImh0dHA6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTIxMDY3NDkxNDYyMzM4OSIsCiAgICAgICAgICAgICAgICAicGhvdG8iOiAiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIuMC8yMTA2NzQ5MTQ2MjMzODkvcGljdHVyZT90eXBlPWxhcmdlIiwKICAgICAgICAgICAgICAgICJwcm92aWRlclNwZWNpZmllciI6ICJmYWNlYm9vayIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJkb21haW4iOiAiYXBwbGUuY29tIiwKICAgICAgICAgICAgICAgICJpZCI6IDc2Nzc3MDY4OSwKICAgICAgICAgICAgICAgICJpZGVudGlmaWVyIjogImh0dHBzOi8vYXBwbGVpZC5hcHBsZS5jb20vMDAwNDIwLmM0MDRmMjBjNjM2YjQwOTViOGUzOWIwNTgyY2QxMWU0LjEwMzYiLAogICAgICAgICAgICAgICAgInBob3RvIjogbnVsbCwKICAgICAgICAgICAgICAgICJwcm92aWRlclNwZWNpZmllciI6ICJhcHBsZSIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyb2xlcyI6IFtdLAogICAgICAgICAgICAidXNlcm5hbWUiOiAibGl2aXU1dGVzdHNAZ21haWwuY29tIiwKICAgICAgICAgICAgInV1aWQiOiAiZmU0OThmZmItMGM1Ny00NDRmLTk5MTYtYmU3OTY0ZTlhZTliIgogICAgICAgICAgfSAgICAgICAgCiAgICBdCn0=

---
apiVersion: v1
kind: Service
metadata:
  name: flask-app-service
  labels:
    app: flask-app
spec:
  type: ClusterIP
  selector:
    app: flask-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 5000
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: flask-app-pvc
spec:
  accessModes:
    - ReadWriteMany
  resources:
      requests:
        storage: 1Gi
